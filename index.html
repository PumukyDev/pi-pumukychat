<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<title>Definición del Proyecto</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child{border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active,#footnotes .footnote a:first-of-type:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge, pre.rouge .w {
  color: #24292f;
  background-color: #f6f8fa;
}
pre.rouge .k, pre.rouge .kd, pre.rouge .kn, pre.rouge .kp, pre.rouge .kr, pre.rouge .kt, pre.rouge .kv {
  color: #cf222e;
}
pre.rouge .gr {
  color: #f6f8fa;
}
pre.rouge .gd {
  color: #82071e;
  background-color: #ffebe9;
}
pre.rouge .nb {
  color: #953800;
}
pre.rouge .nc {
  color: #953800;
}
pre.rouge .no {
  color: #953800;
}
pre.rouge .nn {
  color: #953800;
}
pre.rouge .sr {
  color: #116329;
}
pre.rouge .na {
  color: #116329;
}
pre.rouge .nt {
  color: #116329;
}
pre.rouge .gi {
  color: #116329;
  background-color: #dafbe1;
}
pre.rouge .ges {
  font-weight: bold;
  font-style: italic;
}
pre.rouge .kc {
  color: #0550ae;
}
pre.rouge .l, pre.rouge .ld, pre.rouge .m, pre.rouge .mb, pre.rouge .mf, pre.rouge .mh, pre.rouge .mi, pre.rouge .il, pre.rouge .mo, pre.rouge .mx {
  color: #0550ae;
}
pre.rouge .sb {
  color: #0550ae;
}
pre.rouge .bp {
  color: #0550ae;
}
pre.rouge .ne {
  color: #0550ae;
}
pre.rouge .nl {
  color: #0550ae;
}
pre.rouge .py {
  color: #0550ae;
}
pre.rouge .nv, pre.rouge .vc, pre.rouge .vg, pre.rouge .vi, pre.rouge .vm {
  color: #0550ae;
}
pre.rouge .o, pre.rouge .ow {
  color: #0550ae;
}
pre.rouge .gh {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .gu {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .s, pre.rouge .sa, pre.rouge .sc, pre.rouge .dl, pre.rouge .sd, pre.rouge .s2, pre.rouge .se, pre.rouge .sh, pre.rouge .sx, pre.rouge .s1, pre.rouge .ss {
  color: #0a3069;
}
pre.rouge .nd {
  color: #8250df;
}
pre.rouge .nf, pre.rouge .fm {
  color: #8250df;
}
pre.rouge .err {
  color: #f6f8fa;
  background-color: #82071e;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cm, pre.rouge .cp, pre.rouge .cpf, pre.rouge .c1, pre.rouge .cs {
  color: #6e7781;
}
pre.rouge .gl {
  color: #6e7781;
}
pre.rouge .gt {
  color: #6e7781;
}
pre.rouge .ni {
  color: #24292f;
}
pre.rouge .si {
  color: #24292f;
}
pre.rouge .ge {
  color: #24292f;
  font-style: italic;
}
pre.rouge .gs {
  color: #24292f;
  font-weight: bold;
}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Índice</div>
<ul class="sectlevel1">
<li><a href="#_definición_del_proyecto">1. Definición del Proyecto</a></li>
<li><a href="#_palabras_clave">2. Palabras Clave</a></li>
<li><a href="#_desarrollo_del_proyecto">3. Desarrollo del Proyecto</a>
<ul class="sectlevel2">
<li><a href="#_despliegue">3.1. Despliegue</a>
<ul class="sectlevel3">
<li><a href="#_arquitectura_general">3.1.1. Arquitectura general</a></li>
<li><a href="#_servicios_y_contenedores">3.1.2. Servicios y contenedores</a></li>
</ul>
</li>
<li><a href="#_sistema_de_cifrado_extremo_a_extremo">3.2. Sistema de cifrado extremo a extremo</a>
<ul class="sectlevel3">
<li><a href="#_generación_de_claves">3.2.1. Generación de claves</a></li>
<li><a href="#_cifrado_de_mensajes">3.2.2. Cifrado de mensajes</a></li>
<li><a href="#_descifrado_de_mensajes">3.2.3. Descifrado de mensajes</a></li>
</ul>
</li>
<li><a href="#_manejo_de_datos">3.3. Manejo de datos</a>
<ul class="sectlevel3">
<li><a href="#_procesamiento_y_almacenamiento_de_mensajes">3.3.1. Procesamiento y almacenamiento de mensajes</a></li>
<li><a href="#_validación_de_peticiones">3.3.2. Validación de peticiones</a></li>
<li><a href="#_creación_y_gestión_de_grupos">3.3.3. Creación y gestión de grupos</a></li>
<li><a href="#_eliminación_de_mensajes">3.3.4. Eliminación de mensajes</a></li>
<li><a href="#_actualización_de_conversaciones_y_grupos">3.3.5. Actualización de conversaciones y grupos</a></li>
<li><a href="#_visualización_de_mensajes">3.3.6. Visualización de mensajes.</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_conclusiones">4. Conclusiones</a></li>
<li><a href="#_recursos_bibliográficos_y_páginas_web_consultadas">5. Recursos bibliográficos y páginas web consultadas</a></li>
<li><a href="#_anexos">6. Anexos</a></li>
</ul>
</div>
</div>
<div id="content">
<!-- toc disabled -->
<div style="page-break-after: always;"></div>
<div class="sect1">
<h2 id="_definición_del_proyecto">1. Definición del Proyecto</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Este proyecto consiste en el <strong>despliegue completamente automático de una plataforma de mensajería instantánea cifrada</strong>. El objetivo ha sido lograr una configuración lo más genérica posible, que permita a cualquier usuario desplegar su propia instancia de la aplicación, tanto en local como en un dominio propio, con mínimas modificaciones en un único archivo <code>.env</code>.</p>
</div>
<div class="paragraph">
<p>Toda la infraestructura está desplegada mediante <strong>Docker</strong>, utilizando distintas redes para permitir la comunicación entre contenedores y con servicios externos que actúan como proxy hacia el exterior. El sistema también incluye volúmenes persistentes y bases de datos que garantizan la conservación de la información del usuario incluso tras reinicios o apagados.</p>
</div>
<div class="paragraph">
<p>La lógica de la aplicación está implementada con <strong>Laravel</strong>, un framework de PHP que ha facilitado una gestión organizada y estructurada de todo el backend. La parte visual y el sistema de cifrado se han desarrollado con <strong>React</strong>, una librería de JavaScript que ha permitido crear componentes reutilizables en toda la aplicación. Para los estilos se ha empleado <strong>TailwindCSS</strong>, un framework de utilidades que ha simplificado enormemente el diseño, permitiendo crear una interfaz completamente responsive y adaptable a cualquier dispositivo de forma ágil.</p>
</div>
<div class="paragraph">
<p>Desde el inicio del proyecto se ha priorizado la <strong>seguridad y privacidad de los usuarios</strong>, cifrando los mensajes directamente en el navegador para que el contenido nunca llegue en claro al servidor. Asimismo, se han estudiado los métodos de cifrado más adecuados para garantizar una comunicación segura y eficiente entre los usuarios.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/chat.png" alt="chat">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_palabras_clave">2. Palabras Clave</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Docker, encriptación, laravel, base de datos, react, mensajería</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_desarrollo_del_proyecto">3. Desarrollo del Proyecto</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_despliegue">3.1. Despliegue</h3>
<div class="sect3">
<h4 id="_arquitectura_general">3.1.1. Arquitectura general</h4>
<div class="paragraph">
<p>La aplicación está completamente dockerizada, de forma que <strong>cada servicio se ejecuta de manera independiente en su propio contenedor</strong>. Esta arquitectura basada en contenedores permite un alto nivel de aislamiento, facilita la escalabilidad y simplifica el mantenimiento y la automatización del despliegue.</p>
</div>
<div class="paragraph">
<p>Actualmente el sistema está compuesto por <strong>siete contenedores</strong> con la estructura que se presenta en la imagen:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="assets/mermaids/docker.png" alt="docker">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_servicios_y_contenedores">3.1.2. Servicios y contenedores</h4>
<div class="paragraph">
<p>A continuación se explica el archivo docker-compose, indicando cuál es la finalidad de cada contenedor y por qué está montado de esta forma.</p>
</div>
<div class="sect4">
<h5 id="_nginx">Nginx</h5>
<div class="paragraph">
<p>Contenedor que actúa como un <strong>servidor web</strong> y <strong>proxy inverso</strong>. Se encarga de recibir todas las solicitudes entrantes y redirigirlas al contenedor correspondiente, según el tipo de contenido:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Redirige las peticiones HTTP al contenedor de Laravel (<code>app</code>).</p>
</li>
<li>
<p>Redirige las conexiones WebSocket al contenedor <code>reverb-server</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Está conectado a la red externa <code>proxy-network</code>, lo que le permite comunicarse con el contenedor <code>nginx_proxy</code>, encargado de recibir todas las peticiones procedentes de Internet. Para más detalles sobre la configuración que permite redirigir las solicitudes, utilizar un sistema de DNS dinámico y scripts para paliar con problemas con el orden de arranque, consultar el <a href="https://github.com/PumukyDev/pi-pumukydev/blob/gh-pages/2ASIR_B_BERTOS_GOMEZ_ADRIAN_PUMUKYCHAT-Anexo1.pdf">Anexo 1</a>.</p>
</div>
<div class="listingblock">
<div class="title">Fragmento docker-compose.yml</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">nginx</span><span class="pi">:</span>
  <span class="na">image</span><span class="pi">:</span> <span class="s">nginx:alpine</span>
  <span class="na">container_name</span><span class="pi">:</span> <span class="s">nginx_chat</span>
  <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
  <span class="na">depends_on</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">app</span>
  <span class="na">volumes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">./src:/var/www</span>
    <span class="pi">-</span> <span class="s">./nginx/conf.d/default.conf:/etc/nginx/conf.d/default.conf</span>
    <span class="pi">-</span> <span class="s">./nginx/nginx.conf:/etc/nginx/nginx.conf</span>
  <span class="na">networks</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">proxy-network</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_app">App</h5>
<div class="paragraph">
<p>Contenedor principal del backend, construido con el framework de PHP <strong>Laravel</strong>. Gestiona las peticiones HTTP entrantes, las procesa, accede a la base de datos y coordina el funcionamiento general del sistema. Laravel proporciona una arquitectura basada en controladores, modelos, validaciones y recursos API. Permite descargar paquetes como <strong>Laravel Breeze</strong> que ha permitido implementar fácilmente funcionalidades de autenticación como el inicio de sesión, registro, recuperación de contraseña, etc.</p>
</div>
<div class="listingblock">
<div class="title">Fragmento docker-compose.yml</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">app</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">context</span><span class="pi">:</span> <span class="s">.</span>
    <span class="na">dockerfile</span><span class="pi">:</span> <span class="s">./app/Dockerfile</span>
  <span class="na">container_name</span><span class="pi">:</span> <span class="s">app_chat</span>
  <span class="na">working_dir</span><span class="pi">:</span> <span class="s">/var/www</span>
  <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
  <span class="na">depends_on</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">database</span>
    <span class="pi">-</span> <span class="s">node</span>
  <span class="na">environment</span><span class="pi">:</span>
    <span class="na">DB_DATABASE</span><span class="pi">:</span> <span class="s">${DB_DATABASE}</span>
    <span class="na">DB_USERNAME</span><span class="pi">:</span> <span class="s">${DB_USER}</span>
    <span class="na">DB_PASSWORD</span><span class="pi">:</span> <span class="s">${DB_PASSWORD}</span>
    <span class="na">DB_HOST</span><span class="pi">:</span> <span class="s">database</span>
  <span class="na">volumes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">./src:/var/www</span>
  <span class="na">networks</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">mysql-network</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_queue_worker">Queue Worker</h5>
<div class="paragraph">
<p>Contenedor que ejecuta los <strong>trabajos en segundo plano</strong> (jobs) definidos en Laravel. Permite descargar la carga del contenedor principal <code>app</code> procesando tareas asincrónicas como el borrado de mensajes o grupos enteros, envío de eventos o cualquier operación que pueda tardar mucho sin bloquear la respuesta al usuario.</p>
</div>
<div class="listingblock">
<div class="title">Fragmento docker-compose.yml</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml">  <span class="na">queue-worker</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span>
      <span class="na">context</span><span class="pi">:</span> <span class="s">.</span>
      <span class="na">dockerfile</span><span class="pi">:</span> <span class="s">./app/Dockerfile</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">queue_chat</span>
    <span class="na">working_dir</span><span class="pi">:</span> <span class="s">/var/www</span>
    <span class="na">command</span><span class="pi">:</span> <span class="s">php artisan queue:work</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">app</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">DB_DATABASE</span><span class="pi">:</span> <span class="s">${DB_DATABASE}</span>
      <span class="na">DB_USERNAME</span><span class="pi">:</span> <span class="s">${DB_USER}</span>
      <span class="na">DB_PASSWORD</span><span class="pi">:</span> <span class="s">${DB_PASSWORD}</span>
      <span class="na">DB_HOST</span><span class="pi">:</span> <span class="s">database</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./src:/var/www</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">mysql-network</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_reverb_server">Reverb Server</h5>
<div class="paragraph">
<p>Contenedor que gestiona las <strong>conexiones WebSocket</strong> mediante <strong>Laravel Reverb</strong>, el sistema oficial de Laravel para la comunicación en tiempo real. A través de este servicio, los mensajes se transmiten de forma instantánea a todos los clientes conectados, sin necesidad de recargar la página. Para información sobre los WebSockets, consultar el <a href="https://github.com/PumukyDev/pi-pumukydev/blob/gh-pages/2ASIR_B_BERTOS_GOMEZ_ADRIAN_PUMUKYCHAT-Anexo2.pdf">Anexo 2</a>.</p>
</div>
<div class="listingblock">
<div class="title">Fragmento docker-compose.yml</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml">  <span class="na">reverb-server</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span>
      <span class="na">context</span><span class="pi">:</span> <span class="s">.</span>
      <span class="na">dockerfile</span><span class="pi">:</span> <span class="s">./app/Dockerfile</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">reverb_chat</span>
    <span class="na">working_dir</span><span class="pi">:</span> <span class="s">/var/www</span>
    <span class="na">command</span><span class="pi">:</span> <span class="s">php artisan reverb:start --debug</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">app</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">DB_DATABASE</span><span class="pi">:</span> <span class="s">${DB_DATABASE}</span>
      <span class="na">DB_USERNAME</span><span class="pi">:</span> <span class="s">${DB_USER}</span>
      <span class="na">DB_PASSWORD</span><span class="pi">:</span> <span class="s">${DB_PASSWORD}</span>
      <span class="na">DB_HOST</span><span class="pi">:</span> <span class="s">database</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./src:/var/www</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">mysql-network</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_node">Node</h5>
<div class="paragraph">
<p>Contenedor responsable de la <strong>compilación del frontend</strong>. Utiliza <strong>Vite</strong> para compilar y optimizar los archivos que después se van a servir. Esto es necesario porque el frontend está desarrollado en React y TailwindCSS, y los navegadores no pueden interpretar directamente estos lenguajes.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>React</strong> es una librería de JavaScript para construir interfaces de usuario mediante <strong>componentes reutilizables</strong>. En este proyecto se han creado <strong>34 componentes</strong>, que van desde los más simples (como botones o campos de texto), hasta componentes más complejos como el chat principal, la lista de usuarios y grupos, y el sistema de notificaciones.</p>
</li>
<li>
<p><strong>TailwindCSS</strong> es un framework de CSS que permite crear estilos de forma rápida mediante <strong>clases utilitarias</strong>. En este proyecto se han utilizado <strong>más de 200 clases</strong> para diseñar una interfaz <strong>responsive</strong>, adaptada a cualquier tipo de dispositivo.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Aquí hay unos ejemplos de cómo se ve la aplicación en dispositivos móviles, tanto en modo claro como en modo oscuro:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="assets/light-mobile.png" alt="light mobile">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="assets/dark-mobile.png" alt="dark mobile">
</div>
</div>
<div class="paragraph">
<p>Este contenedor se ejecuta <strong>una sola vez al iniciar el sistema</strong>. Tras la compilación, el servicio se <strong>apaga</strong> y no consume más recursos. En caso de usar este sistema en un entorno de desarrollo, solo habría que cambiar el comando <code>npm run build</code> por <code>npm run dev</code>, y el contenedor recompilaría el código automáticamente tras cada cambio sin apagarse.</p>
</div>
<div class="listingblock">
<div class="title">Fragmento docker-compose.yml</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml">  <span class="na">node</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">node:18</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">node_chat</span>
    <span class="na">working_dir</span><span class="pi">:</span> <span class="s">/app</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./src:/app</span>
    <span class="na">command</span><span class="pi">:</span> <span class="s">sh -c "npm install &amp;&amp; npm run build"</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_database">Database</h5>
<div class="paragraph">
<p>Contenedor que ejecuta una instancia de <strong>MariaDB</strong>, una base de datos relacional muy similar a MySQL utilizada porque estaba optimizada para arquitecturas ARM, lo cual es especialmente importante ya que toda la infraestructura se ejecuta sobre una <strong>Raspberry Pi 5</strong>. En esta base de datos se almacena de forma persistente toda la información de usuarios, conversaciones, mensajes, claves cifradas y archivos adjuntos.</p>
</div>
<div class="listingblock">
<div class="title">Fragmento docker-compose.yml</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml">  <span class="na">database</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">mariadb:latest</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">database_chat</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">MYSQL_DATABASE</span><span class="pi">:</span> <span class="s">${DB_DATABASE}</span>
      <span class="na">MYSQL_ROOT_PASSWORD</span><span class="pi">:</span> <span class="s">${DB_ROOT_PASSWORD}</span>
      <span class="na">MYSQL_USER</span><span class="pi">:</span> <span class="s">${DB_USER}</span>
      <span class="na">MYSQL_PASSWORD</span><span class="pi">:</span> <span class="s">${DB_PASSWORD}</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">db-data:/var/lib/mysql</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">mysql-network</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_phpmyadmin">phpMyAdmin</h5>
<div class="paragraph">
<p>Contenedor que proporciona una <strong>interfaz web gráfica para la administración de la base de datos</strong>. Se utiliza exclusivamente para tareas internas de mantenimiento o inspección de datos y <strong>no está expuesto al exterior</strong>.</p>
</div>
<div class="listingblock">
<div class="title">Fragmento docker-compose.yml</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml">  <span class="na">phpmyadmin</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">phpmyadmin:5.2</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">phpmyadmin_chat</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">PMA_HOST</span><span class="pi">:</span> <span class="s">${PMA_HOST}</span>
      <span class="na">PMA_USER</span><span class="pi">:</span> <span class="s">${PMA_USER}</span>
      <span class="na">PMA_PASSWORD</span><span class="pi">:</span> <span class="s">${PMA_PASSWORD}</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">8080:80"</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">mysql-network</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">database</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sistema_de_cifrado_extremo_a_extremo">3.2. Sistema de cifrado extremo a extremo</h3>
<div class="paragraph">
<p>PumukyChat aplica cifrado extremo a extremo (E2EE) en todas las conversaciones. Solo los participantes legítimos pueden leer el contenido de los mensajes. A continuación se describen las tres fases principales de este sistema: generación de claves, cifrado y descifrado de mensajes.</p>
</div>
<div class="sect3">
<h4 id="_generación_de_claves">3.2.1. Generación de claves</h4>
<div class="imageblock text-center">
<div class="content">
<img src="assets/mermaids/crear-claves.png" alt="crear claves">
</div>
</div>
<div class="paragraph">
<p>Cuando un usuario se registra, genera en su navegador un par de claves RSA de 4096 bits utilizando la <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Crypto_API">Web Crypto API</a>. El siguiente fragmento de <code>Register.jsx</code> muestra cómo se crea el par de claves y se exporta en formato PEM para su almacenamiento:</p>
</div>
<div class="listingblock">
<div class="title">Fragmento Register.jsx</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="kd">const</span> <span class="p">{</span> <span class="nx">publicKey</span><span class="p">,</span> <span class="nx">privateKey</span> <span class="p">}</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">cryptoHelpers</span><span class="p">.</span><span class="nf">generateRSAKeyPair</span><span class="p">();</span>
<span class="c1">// Exportar claves a PEM</span>
<span class="kd">const</span> <span class="nx">publicKeyPem</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">cryptoHelpers</span><span class="p">.</span><span class="nf">exportPublicKey</span><span class="p">(</span><span class="nx">publicKey</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">privateKeyPem</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">cryptoHelpers</span><span class="p">.</span><span class="nf">exportPrivateKey</span><span class="p">(</span><span class="nx">privateKey</span><span class="p">);</span>
<span class="c1">// Guardar la clave privada en IndexedDB</span>
<span class="k">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">keys</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="nx">privateKeyPem</span><span class="p">,</span> <span class="dl">'</span><span class="s1">privateKey</span><span class="dl">'</span><span class="p">);</span>
<span class="c1">// Enviar clave pública al servidor</span>
<span class="nx">socket</span><span class="p">.</span><span class="nf">emit</span><span class="p">(</span><span class="dl">'</span><span class="s1">register</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="nx">username</span><span class="p">,</span> <span class="na">publicKey</span><span class="p">:</span> <span class="nx">publicKeyPem</span> <span class="p">});</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>La clave privada en una base de datos local cifrada llamada IndexedDB SecureChatKeys (almacén keys)</p>
</li>
<li>
<p>La clave pública la envía al servidor para guardarla en la tabla users.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_cifrado_de_mensajes">3.2.2. Cifrado de mensajes</h4>
<div class="imageblock text-center">
<div class="content">
<img src="assets/mermaids/encriptado.png" alt="encriptado">
</div>
</div>
<div class="paragraph">
<p>Al enviar un mensaje, el cliente genera una clave AES de 256 bits y un IV aleatorio de 12 bytes. Luego cifra el texto del mensaje usando AES-GCM con esa clave e IV. Se puede ver esto en <code>MessageInput.jsx</code>:</p>
</div>
<div class="listingblock">
<div class="title">Fragmento MessageInput.jsx</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="kd">const</span> <span class="nx">aesKey</span> <span class="o">=</span> <span class="k">await</span> <span class="nb">window</span><span class="p">.</span><span class="nx">crypto</span><span class="p">.</span><span class="nx">subtle</span><span class="p">.</span><span class="nf">generateKey</span><span class="p">(</span>
<span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">AES-GCM</span><span class="dl">"</span><span class="p">,</span> <span class="na">length</span><span class="p">:</span> <span class="mi">256</span> <span class="p">},</span>
<span class="kc">true</span><span class="p">,</span> <span class="p">[</span><span class="dl">"</span><span class="s2">encrypt</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">decrypt</span><span class="dl">"</span><span class="p">]</span>
<span class="p">);</span>
<span class="kd">const</span> <span class="nx">iv</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">crypto</span><span class="p">.</span><span class="nf">getRandomValues</span><span class="p">(</span><span class="k">new</span> <span class="nc">Uint8Array</span><span class="p">(</span><span class="mi">12</span><span class="p">));</span>
<span class="c1">// Cifrar el mensaje con AES-GCM</span>
<span class="kd">const</span> <span class="nx">encryptedMessage</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">cryptoHelpers</span><span class="p">.</span><span class="nf">encryptWithAES</span><span class="p">(</span><span class="nx">aesKey</span><span class="p">,</span> <span class="nx">iv</span><span class="p">,</span> <span class="nx">messageText</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A continuación se exporta la clave AES (raw), y esa clave se cifra usando RSA-OAEP con la clave pública de cada participante (remitente y receptores). Por ejemplo:</p>
</div>
<div class="listingblock">
<div class="title">Fragmento MessageInput.jsx</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="kd">const</span> <span class="nx">rawAesKey</span> <span class="o">=</span> <span class="k">await</span> <span class="nb">window</span><span class="p">.</span><span class="nx">crypto</span><span class="p">.</span><span class="nx">subtle</span><span class="p">.</span><span class="nf">exportKey</span><span class="p">(</span><span class="dl">"</span><span class="s2">raw</span><span class="dl">"</span><span class="p">,</span> <span class="nx">aesKey</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">recipients</span> <span class="o">=</span> <span class="p">[</span><span class="nx">senderPublicKeyPem</span><span class="p">,</span> <span class="p">...</span><span class="nx">otherRecipientsPublicKeys</span><span class="p">];</span>
<span class="k">for </span><span class="p">(</span><span class="kd">const</span> <span class="nx">pubPem</span> <span class="k">of</span> <span class="nx">recipients</span><span class="p">)</span> <span class="p">{</span>
<span class="kd">const</span> <span class="nx">pubKey</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">cryptoHelpers</span><span class="p">.</span><span class="nf">importPublicKey</span><span class="p">(</span><span class="nx">pubPem</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">encryptedKey</span> <span class="o">=</span> <span class="k">await</span> <span class="nb">window</span><span class="p">.</span><span class="nx">crypto</span><span class="p">.</span><span class="nx">subtle</span><span class="p">.</span><span class="nf">encrypt</span><span class="p">(</span>
<span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">RSA-OAEP</span><span class="dl">"</span> <span class="p">},</span>
<span class="nx">pubKey</span><span class="p">,</span>
<span class="nx">rawAesKey</span>
<span class="p">);</span>
<span class="c1">// Enviar o guardar encryptedKey para este destinatario</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finalmente, el cliente envía al servidor el mensaje cifrado (con su IV) y cada clave AES cifrada. El servidor almacena el mensaje en la tabla messages y cada clave AES cifrada en la tabla message_keys, asociando cada clave con el identificador del mensaje y del usuario destinatario.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="assets/messages.png" alt="messages">
</div>
</div>
<div id="message_keys" class="imageblock text-center">
<div class="content">
<img src="assets/message_keys.png" alt="message keys">
</div>
</div>
<div class="paragraph">
<p>Como se observa en las imágenes anteriores, la tabla <code>message_keys</code> crece mucho más rápido que la tabla <code>messages</code>. Ya que hay que cifrar cada mensaje para cada usuario con acceso al mensaje.</p>
</div>
<div class="paragraph">
<p>Por ejemplo, el mensaje con <code>id = 2</code> aparece asociado a dos claves (usuarios 1 y 2), mientras que el mensaje con <code>id = 11</code>, enviado a un grupo, tiene seis claves asociadas (una por cada miembro del grupo).</p>
</div>
</div>
<div class="sect3">
<h4 id="_descifrado_de_mensajes">3.2.3. Descifrado de mensajes</h4>
<div class="imageblock text-center">
<div class="content">
<img src="assets/mermaids/desencriptado.png" alt="desencriptado">
</div>
</div>
<div class="paragraph">
<p>Al recibir nuevos mensajes, el cliente primero carga su clave privada RSA de IndexedDB:</p>
</div>
<div class="listingblock">
<div class="title">Fragmento Home.jsx</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="kd">const</span> <span class="nx">db</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">openDB</span><span class="p">(</span><span class="dl">"</span><span class="s2">SecureChatKeys</span><span class="dl">"</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">privateKeyPem</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">keys</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">privateKey</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">privateKey</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">cryptoHelpers</span><span class="p">.</span><span class="nf">importPrivateKey</span><span class="p">(</span><span class="nx">privateKeyPem</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Luego solicita al servidor el mensaje cifrado, su IV y la clave AES cifrada correspondiente a ese usuario. Con la clave privada RSA, descifra la clave AES:</p>
</div>
<div class="listingblock">
<div class="title">Fragmento Home.jsx</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="kd">const</span> <span class="nx">decryptedRawKey</span> <span class="o">=</span> <span class="k">await</span> <span class="nb">window</span><span class="p">.</span><span class="nx">crypto</span><span class="p">.</span><span class="nx">subtle</span><span class="p">.</span><span class="nf">decrypt</span><span class="p">(</span>
<span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">RSA-OAEP</span><span class="dl">"</span> <span class="p">},</span>
<span class="nx">privateKey</span><span class="p">,</span>
<span class="nx">encryptedKeyForThisUser</span>
<span class="p">);</span>
<span class="c1">// Importar clave AES descifrada</span>
<span class="kd">const</span> <span class="nx">aesKey</span> <span class="o">=</span> <span class="k">await</span> <span class="nb">window</span><span class="p">.</span><span class="nx">crypto</span><span class="p">.</span><span class="nx">subtle</span><span class="p">.</span><span class="nf">importKey</span><span class="p">(</span>
<span class="dl">"</span><span class="s2">raw</span><span class="dl">"</span><span class="p">,</span> <span class="nx">decryptedRawKey</span><span class="p">,</span> <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">AES-GCM</span><span class="dl">"</span> <span class="p">},</span>
<span class="kc">false</span><span class="p">,</span> <span class="p">[</span><span class="dl">"</span><span class="s2">decrypt</span><span class="dl">"</span><span class="p">]</span>
<span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Con la clave AES importada, finalmente descifra el mensaje con AES-GCM.</p>
</div>
<div class="listingblock">
<div class="title">Fragmento cryptoHelpers.js</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="kd">const</span> <span class="nx">decryptedMessage</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">cryptoHelpers</span><span class="p">.</span><span class="nf">decryptWithAES</span><span class="p">(</span><span class="nx">aesKey</span><span class="p">,</span> <span class="nx">iv</span><span class="p">,</span> <span class="nx">encryptedMessage</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>El texto original descifrado se muestra en pantalla. Así, solo el destinatario legítimo (poseedor de la clave privada RSA) puede recuperar la clave AES y leer el contenido del mensaje.</p>
</div>
<div class="paragraph">
<p>Para más información sobre el sistema de encriptación usado como por ejemplo por qué se cifran dos veces los mensajes o por qué no se usan otras alternativas, consulta el <a href="https://github.com/PumukyDev/pi-pumukydev/blob/gh-pages/2ASIR_B_BERTOS_GOMEZ_ADRIAN_PUMUKYCHAT-Anexo3.pdf">Anexo 3</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_manejo_de_datos">3.3. Manejo de datos</h3>
<div class="sect3">
<h4 id="_procesamiento_y_almacenamiento_de_mensajes">3.3.1. Procesamiento y almacenamiento de mensajes</h4>
<div class="paragraph">
<p>Cuando un usuario envía un mensaje, el <code>MessageController</code> maneja la petición validada por <code>StoreMessageRequest</code>. A partir de ahí, se ejecuta la lógica principal en varios pasos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Se comprueba si es un mensaje privado o de grupo. En el primer caso, debe incluirse la clave AES cifrada tanto para el emisor como para el receptor.</p>
</li>
<li>
<p>Se crea el registro del mensaje en la tabla <code>messages</code>, guardando el contenido cifrado.</p>
</li>
<li>
<p>Se guardan las claves AES cifradas en la tabla <code>message_keys</code> (la cual vimos <a href="#message_keys">anteriomente</a>). En mensajes privados se guardan dos (una por usuario). En grupos, se guarda una por cada miembro.</p>
</li>
<li>
<p>Si hay archivos adjuntos, se almacenan en disco y se asocian al mensaje mediante <code>message_attachments</code>.</p>
</li>
<li>
<p>Se actualiza el campo <code>last_message_id</code> en la conversación o grupo correspondiente.</p>
</li>
<li>
<p>Se emite un evento WebSocket (<code>SocketMessage</code>) con el mensaje.</p>
</li>
<li>
<p>Se carga el mensaje con sus relaciones para devolverlo en la respuesta final.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Fragmento MessageController.php</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="php"><span class="k">public</span> <span class="k">function</span> <span class="n">store</span><span class="p">(</span><span class="kt">StoreMessageRequest</span> <span class="nv">$request</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$data</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="nf">validated</span><span class="p">();</span>
    <span class="nv">$senderId</span> <span class="o">=</span> <span class="nf">auth</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">id</span><span class="p">();</span>
    <span class="nv">$data</span><span class="p">[</span><span class="s1">'sender_id'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$senderId</span><span class="p">;</span>
    <span class="nv">$receiverId</span> <span class="o">=</span> <span class="nv">$data</span><span class="p">[</span><span class="s1">'receiver_id'</span><span class="p">]</span> <span class="o">??</span> <span class="kc">null</span><span class="p">;</span>
    <span class="nv">$groupId</span> <span class="o">=</span> <span class="nv">$data</span><span class="p">[</span><span class="s1">'group_id'</span><span class="p">]</span> <span class="o">??</span> <span class="kc">null</span><span class="p">;</span>
    <span class="nv">$files</span> <span class="o">=</span> <span class="nv">$data</span><span class="p">[</span><span class="s1">'attachments'</span><span class="p">]</span> <span class="o">??</span> <span class="p">[];</span>

    <span class="c1">// Guardar mensaje cifrado</span>
    <span class="nv">$message</span> <span class="o">=</span> <span class="nc">Message</span><span class="o">::</span><span class="nf">create</span><span class="p">([</span>
        <span class="s1">'message'</span> <span class="o">=&gt;</span> <span class="nv">$data</span><span class="p">[</span><span class="s1">'message'</span><span class="p">],</span>
        <span class="s1">'sender_id'</span> <span class="o">=&gt;</span> <span class="nv">$senderId</span><span class="p">,</span>
        <span class="s1">'receiver_id'</span> <span class="o">=&gt;</span> <span class="nv">$receiverId</span><span class="p">,</span>
        <span class="s1">'group_id'</span> <span class="o">=&gt;</span> <span class="nv">$groupId</span><span class="p">,</span>
    <span class="p">]);</span>

    <span class="c1">// Guardar claves cifradas</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$receiverId</span><span class="p">)</span> <span class="p">{</span>
        <span class="nc">MessageKey</span><span class="o">::</span><span class="nf">create</span><span class="p">([</span>
            <span class="s1">'message_id'</span> <span class="o">=&gt;</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">'user_id'</span> <span class="o">=&gt;</span> <span class="nv">$senderId</span><span class="p">,</span>
            <span class="s1">'encrypted_key'</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="nf">input</span><span class="p">(</span><span class="s1">'encrypted_key_for_sender'</span><span class="p">),</span>
        <span class="p">]);</span>
        <span class="nc">MessageKey</span><span class="o">::</span><span class="nf">create</span><span class="p">([</span>
            <span class="s1">'message_id'</span> <span class="o">=&gt;</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">'user_id'</span> <span class="o">=&gt;</span> <span class="nv">$receiverId</span><span class="p">,</span>
            <span class="s1">'encrypted_key'</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="nf">input</span><span class="p">(</span><span class="s1">'encrypted_key_for_receiver'</span><span class="p">),</span>
        <span class="p">]);</span>
    <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$groupId</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$keys</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="nf">input</span><span class="p">(</span><span class="s1">'keys'</span><span class="p">,</span> <span class="p">[]);</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$keys</span> <span class="k">as</span> <span class="nv">$userId</span> <span class="o">=&gt;</span> <span class="nv">$encryptedKey</span><span class="p">)</span> <span class="p">{</span>
            <span class="nc">MessageKey</span><span class="o">::</span><span class="nf">create</span><span class="p">([</span>
                <span class="s1">'message_id'</span> <span class="o">=&gt;</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">,</span>
                <span class="s1">'user_id'</span> <span class="o">=&gt;</span> <span class="nv">$userId</span><span class="p">,</span>
                <span class="s1">'encrypted_key'</span> <span class="o">=&gt;</span> <span class="nv">$encryptedKey</span><span class="p">,</span>
            <span class="p">]);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// Guardar adjuntos</span>
    <span class="nv">$attachments</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$files</span> <span class="k">as</span> <span class="nv">$file</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$directory</span> <span class="o">=</span> <span class="s1">'attachments/'</span> <span class="mf">.</span> <span class="nc">Str</span><span class="o">::</span><span class="nf">random</span><span class="p">(</span><span class="mi">32</span><span class="p">);</span>
        <span class="nv">$attachments</span><span class="p">[]</span> <span class="o">=</span> <span class="nc">MessageAttachment</span><span class="o">::</span><span class="nf">create</span><span class="p">([</span>
            <span class="s1">'message_id'</span> <span class="o">=&gt;</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="nv">$file</span><span class="o">-&gt;</span><span class="nf">getClientOriginalName</span><span class="p">(),</span>
            <span class="s1">'mime'</span> <span class="o">=&gt;</span> <span class="nv">$file</span><span class="o">-&gt;</span><span class="nf">getClientMimeType</span><span class="p">(),</span>
            <span class="s1">'size'</span> <span class="o">=&gt;</span> <span class="nv">$file</span><span class="o">-&gt;</span><span class="nf">getSize</span><span class="p">(),</span>
            <span class="s1">'path'</span> <span class="o">=&gt;</span> <span class="nv">$file</span><span class="o">-&gt;</span><span class="nf">store</span><span class="p">(</span><span class="nv">$directory</span><span class="p">,</span> <span class="s1">'public'</span><span class="p">),</span>
        <span class="p">]);</span>
    <span class="p">}</span>
    <span class="nv">$message</span><span class="o">-&gt;</span><span class="n">attachments</span> <span class="o">=</span> <span class="nv">$attachments</span><span class="p">;</span>

    <span class="c1">// Actualizar la conversación o grupo</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$receiverId</span><span class="p">)</span> <span class="p">{</span>
        <span class="nc">Conversation</span><span class="o">::</span><span class="nf">updateConversationWithMessage</span><span class="p">(</span><span class="nv">$receiverId</span><span class="p">,</span> <span class="nv">$senderId</span><span class="p">,</span> <span class="nv">$message</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$groupId</span><span class="p">)</span> <span class="p">{</span>
        <span class="nc">Group</span><span class="o">::</span><span class="nf">updateGroupWithMessage</span><span class="p">(</span><span class="nv">$groupId</span><span class="p">,</span> <span class="nv">$message</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Emitir mensaje por WebSocket</span>
    <span class="nv">$messageToEmit</span> <span class="o">=</span> <span class="k">clone</span> <span class="nv">$message</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="nf">has</span><span class="p">(</span><span class="s1">'message'</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">$messageToEmit</span><span class="o">-&gt;</span><span class="n">message</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="nf">input</span><span class="p">(</span><span class="s1">'message'</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nc">SocketMessage</span><span class="o">::</span><span class="nf">dispatch</span><span class="p">(</span><span class="nv">$messageToEmit</span><span class="p">);</span>

    <span class="c1">// Devolver el mensaje con relaciones</span>
    <span class="nv">$message</span> <span class="o">=</span> <span class="nc">Message</span><span class="o">::</span><span class="nf">with</span><span class="p">(</span><span class="s1">'sender'</span><span class="p">,</span> <span class="s1">'attachments'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">find</span><span class="p">(</span><span class="nv">$message</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">);</span>

    <span class="k">return</span> <span class="k">new</span> <span class="nc">MessageResource</span><span class="p">(</span><span class="nv">$message</span><span class="p">);</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_validación_de_peticiones">3.3.2. Validación de peticiones</h4>
<div class="paragraph">
<p>Las peticiones HTTP que crean o actualizan recursos en la aplicación pasan por objetos de validación específicos (<code>FormRequest</code>) que se encargan de garantizar que los datos son coherentes, seguros y completos antes de ser procesados.</p>
</div>
<div class="paragraph">
<p>Esto reduce la lógica en los controladores y previene inconsistencias, como enviar mensajes vacíos, grupos sin usuarios o claves malformateadas.</p>
</div>
<div class="paragraph">
<p>Para lograr esto, se implementan muchas validaciones para los diferentes endpoints. Vamos a explicar brevemente las validaciones al enviar un mensaje o crear un grupo, pero hay muchos más para por ejemplo actualizar los datos de un grupo, del perfil, etc.</p>
</div>
<div class="sect4">
<h5 id="_validación_al_enviar_un_mensaje_storemessagerequest">Validación al enviar un mensaje (<code>StoreMessageRequest</code>)</h5>
<div class="paragraph">
<p>Este <code>FormRequest</code> permite enviar tanto mensajes de texto como archivos adjuntos, ya sea a un grupo o a un usuario concreto. También valida las claves cifradas asociadas a cada destinatario:</p>
</div>
<div class="listingblock">
<div class="title">Fragmento StoreMessageRequest.php</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="php"><span class="k">public</span> <span class="k">function</span> <span class="n">rules</span><span class="p">():</span> <span class="kt">array</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="s1">'message'</span> <span class="o">=&gt;</span> <span class="s1">'nullable|string'</span><span class="p">,</span>
        <span class="s1">'group_id'</span> <span class="o">=&gt;</span> <span class="s1">'required_without:receiver_id|nullable|exists:groups,id'</span><span class="p">,</span>
        <span class="s1">'receiver_id'</span> <span class="o">=&gt;</span> <span class="s1">'required_without:group_id|nullable|exists:users,id'</span><span class="p">,</span>
        <span class="s1">'attachments'</span> <span class="o">=&gt;</span> <span class="s1">'nullable|array|max:10'</span><span class="p">,</span>
        <span class="s1">'attachments.*'</span> <span class="o">=&gt;</span> <span class="s1">'file|max:1024000'</span><span class="p">,</span>
        <span class="s1">'keys'</span> <span class="o">=&gt;</span> <span class="s1">'nullable|array'</span><span class="p">,</span>
        <span class="s1">'keys.*'</span> <span class="o">=&gt;</span> <span class="s1">'required|string'</span><span class="p">,</span>
    <span class="p">];</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>message</code>: texto del mensaje (puede ser nulo si solo hay adjuntos).</p>
</li>
<li>
<p><code>group_id</code> / <code>receiver_id</code>: uno de los dos debe estar presente, nunca ambos nulos.</p>
</li>
<li>
<p><code>attachments</code>: permite hasta 10 archivos de máximo 1 GB cada uno (aunque esto está limitado por nginx a 500MB en total).</p>
</li>
<li>
<p><code>keys</code>: claves AES cifradas por usuario.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="store_group_request">Validación al crear un grupo (<code>StoreGroupRequest</code>)</h5>
<div class="paragraph">
<p>Este <code>FormRequest</code> asegura que el grupo tenga nombre válido y usuarios válidos. También establece automáticamente el <code>owner_id</code> del grupo como el usuario autenticado:</p>
</div>
<div class="listingblock">
<div class="title">Fragmento StoreGroupRequest.php</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="php"><span class="k">public</span> <span class="k">function</span> <span class="n">rules</span><span class="p">():</span> <span class="kt">array</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">'required'</span><span class="p">,</span> <span class="s1">'string'</span><span class="p">,</span> <span class="s1">'max:255'</span><span class="p">],</span>
        <span class="s1">'description'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">'nullable'</span><span class="p">,</span> <span class="s1">'string'</span><span class="p">],</span>
        <span class="s1">'user_ids'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">'nullable'</span><span class="p">,</span> <span class="s1">'array'</span><span class="p">],</span>
        <span class="s1">'user_ids.*'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">'integer'</span><span class="p">,</span> <span class="s1">'exists:users,id'</span><span class="p">],</span>
    <span class="p">];</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">function</span> <span class="n">validated</span><span class="p">(</span><span class="nv">$key</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span> <span class="nv">$default</span> <span class="o">=</span> <span class="kc">null</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$validated</span> <span class="o">=</span> <span class="k">parent</span><span class="o">::</span><span class="nf">validated</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$default</span><span class="p">);</span>
    <span class="nv">$validated</span><span class="p">[</span><span class="s1">'owner_id'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">;</span>
    <span class="k">return</span> <span class="nv">$validated</span><span class="p">;</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code>: obligatorio.</p>
</li>
<li>
<p><code>description</code>: opcional.</p>
</li>
<li>
<p><code>user_ids</code>: usuarios que formarán parte del grupo.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_creación_y_gestión_de_grupos">3.3.3. Creación y gestión de grupos</h4>
<div class="paragraph">
<p>El <code>GroupController</code> se encarga de crear, actualizar y eliminar grupos de chat. Internamente, usa <a href="#store_group_request">peticiones validadas</a> y un job en segundo plano (<code>DeleteGroupJob</code>) para gestionar correctamente los recursos asociados.</p>
</div>
<div class="sect4">
<h5 id="_creación_de_grupos">Creación de grupos</h5>
<div class="paragraph">
<p>Una vez validados los datos, el controlardor se encarga de crear el grupo en la base de datos.</p>
</div>
<div class="listingblock">
<div class="title">Fragmento GroupController.php</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="php"><span class="k">public</span> <span class="k">function</span> <span class="n">store</span><span class="p">(</span><span class="kt">StoreGroupRequest</span> <span class="nv">$request</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$data</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="nf">validated</span><span class="p">();</span>
    <span class="nv">$user_ids</span> <span class="o">=</span> <span class="nv">$data</span><span class="p">[</span><span class="s1">'user_ids'</span><span class="p">]</span> <span class="o">??</span> <span class="p">[];</span>

    <span class="nv">$group</span> <span class="o">=</span> <span class="nc">Group</span><span class="o">::</span><span class="nf">create</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
    <span class="nv">$group</span><span class="o">-&gt;</span><span class="nf">users</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">attach</span><span class="p">(</span><span class="nb">array_unique</span><span class="p">([</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="nf">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">,</span> <span class="mf">...</span><span class="nv">$user_ids</span><span class="p">]));</span>

    <span class="k">return</span> <span class="nf">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">back</span><span class="p">();</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Group::create($data)</code> crea el grupo con el nombre y descripción proporcionados.</p>
</li>
<li>
<p>Se añaden los usuarios al grupo, incluyendo siempre al creador.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_eliminación_de_grupos">Eliminación de grupos</h5>
<div class="paragraph">
<p>Cuando un usuario elimina un grupo, se programa un job asíncrono con un pequeño retraso de 10 segundos. Esto evita que la eliminación bloquee la respuesta HTTP y permite liberar los recursos de forma ordenada.</p>
</div>
<div class="listingblock">
<div class="title">Fragmento GroupController.php</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="php"><span class="k">public</span> <span class="k">function</span> <span class="n">destroy</span><span class="p">(</span><span class="kt">Group</span> <span class="nv">$group</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$group</span><span class="o">-&gt;</span><span class="n">owner_id</span> <span class="o">!==</span> <span class="nf">auth</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">id</span><span class="p">())</span> <span class="p">{</span>
        <span class="nf">abort</span><span class="p">(</span><span class="mi">403</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nc">DeleteGroupJob</span><span class="o">::</span><span class="nf">dispatch</span><span class="p">(</span><span class="nv">$group</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">delay</span><span class="p">(</span><span class="nf">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">addSeconds</span><span class="p">(</span><span class="mi">10</span><span class="p">));</span>

    <span class="k">return</span> <span class="nf">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">json</span><span class="p">([</span><span class="s1">'message'</span> <span class="o">=&gt;</span> <span class="s1">'Group delete was scheduled and will be deleted soon'</span><span class="p">]);</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Solo el propietario del grupo puede eliminarlo.</p>
</li>
<li>
<p>La tarea se pospone ligeramente con <code>&#8594;delay(&#8230;&#8203;)</code> para evitar conflictos con eventos en curso.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_eliminación_de_mensajes">3.3.4. Eliminación de mensajes</h4>
<div class="paragraph">
<p>Cuando un usuario elimina un mensaje, no solo se borra su contenido de la base de datos, sino que también se eliminan todos los recursos asociados: claves AES cifradas, archivos adjuntos y referencias al último mensaje en conversaciones o grupos.</p>
</div>
<div class="paragraph">
<p>Este proceso se divide en dos niveles complementarios:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Nivel 1: Controlador (<code>MessageController</code>)</strong>, que inicia la eliminación tras verificar permisos.</p>
</li>
<li>
<p><strong>Nivel 2: Observador (<code>MessageObserver</code>)</strong>, que limpia y actualiza relaciones automáticamente tras la eliminación.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_desde_el_controlador">Desde el controlador</h5>
<div class="paragraph">
<p>El método <code>destroy()</code> en <code>MessageController</code> es el punto de entrada cuando un usuario quiere eliminar un mensaje. Este método:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Verifica que el usuario autenticado sea el remitente del mensaje.</p>
</li>
<li>
<p>Elimina todas las claves AES cifradas asociadas al mensaje (de la tabla <code>message_keys</code>).</p>
</li>
<li>
<p>Elimina cada archivo adjunto tanto del sistema de ficheros como de la base de datos.</p>
</li>
<li>
<p>Elimina el mensaje, lo cual automáticamente dispara el <code>observer</code>.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Fragmento MessageController.php</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="php"><span class="k">public</span> <span class="k">function</span> <span class="n">destroy</span><span class="p">(</span><span class="kt">Message</span> <span class="nv">$message</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$message</span><span class="o">-&gt;</span><span class="n">sender_id</span> <span class="o">!==</span> <span class="nf">auth</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">id</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nf">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">json</span><span class="p">([</span><span class="s1">'message'</span> <span class="o">=&gt;</span> <span class="s1">'Forbidden'</span><span class="p">],</span> <span class="mi">403</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Eliminar claves cifradas asociadas</span>
    <span class="nv">$message</span><span class="o">-&gt;</span><span class="nf">keys</span><span class="p">()</span><span class="o">-&gt;</span><span class="nb">delete</span><span class="p">();</span>

    <span class="c1">// Eliminar cada archivo físico y su registro</span>
    <span class="nv">$message</span><span class="o">-&gt;</span><span class="nf">attachments</span><span class="p">()</span><span class="o">-&gt;</span><span class="nb">each</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$attachment</span><span class="p">)</span> <span class="p">{</span>
        <span class="nc">Storage</span><span class="o">::</span><span class="nf">disk</span><span class="p">(</span><span class="s1">'public'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">delete</span><span class="p">(</span><span class="nv">$attachment</span><span class="o">-&gt;</span><span class="n">path</span><span class="p">);</span>
        <span class="nv">$attachment</span><span class="o">-&gt;</span><span class="nb">delete</span><span class="p">();</span>
    <span class="p">});</span>

    <span class="c1">// Eliminar el mensaje (esto dispara el observer)</span>
    <span class="nv">$message</span><span class="o">-&gt;</span><span class="nb">delete</span><span class="p">();</span>

    <span class="k">return</span> <span class="nf">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">json</span><span class="p">([</span><span class="s1">'message'</span> <span class="o">=&gt;</span> <span class="s1">'Message deleted successfully'</span><span class="p">]);</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_desde_el_observer">Desde el observer</h5>
<div class="paragraph">
<p>Una vez que se elimina un mensaje con <code>$message&#8594;delete()</code>, Laravel ejecuta automáticamente el método <code>deleting()</code> del <code>MessageObserver</code>. Este método:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Borra el directorio completo donde estaban almacenados los archivos adjuntos.</p>
</li>
<li>
<p>Vuelve a eliminar los registros de adjuntos (por si quedaron).</p>
</li>
<li>
<p>Comprueba si el mensaje eliminado era el último de una conversación o grupo.</p>
<div class="ulist">
<ul>
<li>
<p>Si lo era, busca el mensaje anterior más reciente y actualiza <code>last_message_id</code>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Esto garantiza que las conversaciones y grupos mantengan su historial consistente incluso tras borrar mensajes.</p>
</div>
<div class="listingblock">
<div class="title">Fragmento MessageObserver.php</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="php"><span class="k">public</span> <span class="k">function</span> <span class="n">deleting</span><span class="p">(</span><span class="kt">Message</span> <span class="nv">$message</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Eliminar carpetas de adjuntos</span>
    <span class="nv">$message</span><span class="o">-&gt;</span><span class="n">attachments</span><span class="o">-&gt;</span><span class="nb">each</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$attachment</span><span class="p">)</span> <span class="p">{</span>
        <span class="nc">Storage</span><span class="o">::</span><span class="nf">disk</span><span class="p">(</span><span class="s1">'public'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">deleteDirectory</span><span class="p">(</span><span class="nb">dirname</span><span class="p">(</span><span class="nv">$attachment</span><span class="o">-&gt;</span><span class="n">path</span><span class="p">));</span>
    <span class="p">});</span>

    <span class="c1">// Eliminar registros de adjuntos (refuerzo)</span>
    <span class="nv">$message</span><span class="o">-&gt;</span><span class="nf">attachments</span><span class="p">()</span><span class="o">-&gt;</span><span class="nb">delete</span><span class="p">();</span>

    <span class="c1">// Si es mensaje de grupo, actualizar el last_message_id</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$message</span><span class="o">-&gt;</span><span class="n">group_id</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$group</span> <span class="o">=</span> <span class="nc">Group</span><span class="o">::</span><span class="nf">where</span><span class="p">(</span><span class="s1">'last_message_id'</span><span class="p">,</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">first</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$group</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$prev</span> <span class="o">=</span> <span class="nc">Message</span><span class="o">::</span><span class="nf">where</span><span class="p">(</span><span class="s1">'group_id'</span><span class="p">,</span> <span class="nv">$group</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nf">where</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span> <span class="s1">'!='</span><span class="p">,</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nf">latest</span><span class="p">()</span>
                <span class="o">-&gt;</span><span class="nf">first</span><span class="p">();</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$prev</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$group</span><span class="o">-&gt;</span><span class="n">last_message_id</span> <span class="o">=</span> <span class="nv">$prev</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">;</span>
                <span class="nv">$group</span><span class="o">-&gt;</span><span class="nf">save</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">// Si es conversación individual, hacer lo mismo</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="nv">$conversation</span> <span class="o">=</span> <span class="nc">Conversation</span><span class="o">::</span><span class="nf">where</span><span class="p">(</span><span class="s1">'last_message_id'</span><span class="p">,</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">first</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$conversation</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$prev</span> <span class="o">=</span> <span class="nc">Message</span><span class="o">::</span><span class="nf">where</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$q</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$message</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nv">$q</span><span class="o">-&gt;</span><span class="nf">where</span><span class="p">(</span><span class="s1">'sender_id'</span><span class="p">,</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="n">sender_id</span><span class="p">)</span>
                      <span class="o">-&gt;</span><span class="nf">where</span><span class="p">(</span><span class="s1">'receiver_id'</span><span class="p">,</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="n">receiver_id</span><span class="p">)</span>
                      <span class="o">-&gt;</span><span class="nf">orWhere</span><span class="p">(</span><span class="s1">'sender_id'</span><span class="p">,</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="n">receiver_id</span><span class="p">)</span>
                      <span class="o">-&gt;</span><span class="nf">where</span><span class="p">(</span><span class="s1">'receiver_id'</span><span class="p">,</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="n">sender_id</span><span class="p">);</span>
                <span class="p">})</span>
                <span class="o">-&gt;</span><span class="nf">where</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span> <span class="s1">'!='</span><span class="p">,</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="nf">latest</span><span class="p">()</span>
                <span class="o">-&gt;</span><span class="nf">first</span><span class="p">();</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$prev</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$conversation</span><span class="o">-&gt;</span><span class="n">last_message_id</span> <span class="o">=</span> <span class="nv">$prev</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">;</span>
                <span class="nv">$conversation</span><span class="o">-&gt;</span><span class="nf">save</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_actualización_de_conversaciones_y_grupos">3.3.5. Actualización de conversaciones y grupos</h4>
<div class="paragraph">
<p>Cuando se envía un nuevo mensaje, se actualiza el campo <code>last_message_id</code>, que permite ordenar los mensajes en la barra lateral. Esto se logra usándo métodos dentro de los modelos <code>Conversation</code> y <code>Group</code>.</p>
</div>
<div class="sect4">
<h5 id="_conversaciones_individuales">Conversaciones individuales</h5>
<div class="paragraph">
<p>El modelo <code>Conversation</code> representa una relación 1:1 entre dos usuarios. Cada vez que se envía un nuevo mensaje, se llama al método <code>updateConversationWithMessage</code>, que:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Busca si ya existe una conversación entre los dos usuarios involucrados (en cualquier orden).</p>
</li>
<li>
<p>Si existe, actualiza su campo <code>last_message_id</code>.</p>
</li>
<li>
<p>Si no existe, crea una nueva conversación con ese último mensaje.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Fragmento Conversation.php</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="php"><span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="n">updateConversationWithMessage</span><span class="p">(</span><span class="nv">$userId1</span><span class="p">,</span> <span class="nv">$userId2</span><span class="p">,</span> <span class="nv">$message</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$conversation</span> <span class="o">=</span> <span class="k">self</span><span class="o">::</span><span class="nf">where</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$query</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$userId1</span><span class="p">,</span> <span class="nv">$userId2</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$query</span><span class="o">-&gt;</span><span class="nf">where</span><span class="p">(</span><span class="s1">'user_id1'</span><span class="p">,</span> <span class="nv">$userId1</span><span class="p">)</span>
              <span class="o">-&gt;</span><span class="nf">where</span><span class="p">(</span><span class="s1">'user_id2'</span><span class="p">,</span> <span class="nv">$userId2</span><span class="p">);</span>
    <span class="p">})</span><span class="o">-&gt;</span><span class="nf">orWhere</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$query</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$userId1</span><span class="p">,</span> <span class="nv">$userId2</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$query</span><span class="o">-&gt;</span><span class="nf">where</span><span class="p">(</span><span class="s1">'user_id1'</span><span class="p">,</span> <span class="nv">$userId2</span><span class="p">)</span>
              <span class="o">-&gt;</span><span class="nf">where</span><span class="p">(</span><span class="s1">'user_id2'</span><span class="p">,</span> <span class="nv">$userId1</span><span class="p">);</span>
    <span class="p">})</span><span class="o">-&gt;</span><span class="nf">first</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$conversation</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$conversation</span><span class="o">-&gt;</span><span class="nf">update</span><span class="p">([</span>
            <span class="s1">'last_message_id'</span> <span class="o">=&gt;</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">,</span>
        <span class="p">]);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">::</span><span class="nf">create</span><span class="p">([</span>
            <span class="s1">'user_id1'</span> <span class="o">=&gt;</span> <span class="nv">$userId1</span><span class="p">,</span>
            <span class="s1">'user_id2'</span> <span class="o">=&gt;</span> <span class="nv">$userId2</span><span class="p">,</span>
            <span class="s1">'last_message_id'</span> <span class="o">=&gt;</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">,</span>
        <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_grupos">Grupos</h5>
<div class="paragraph">
<p>El modelo <code>Group</code> también actualiza su campo <code>last_message_id</code> cada vez que recibe un nuevo mensaje. Esto se realiza a través del método <code>updateGroupWithMessage</code>.</p>
</div>
<div class="listingblock">
<div class="title">Fragmento Group.php</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="php"><span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="n">updateGroupWithMessage</span><span class="p">(</span><span class="nv">$groupId</span><span class="p">,</span> <span class="nv">$message</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="k">self</span><span class="o">::</span><span class="nf">updateOrCreate</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">'id'</span> <span class="o">=&gt;</span> <span class="nv">$groupId</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">'last_message_id'</span> <span class="o">=&gt;</span> <span class="nv">$message</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">]</span>
    <span class="p">);</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_visualización_de_mensajes">3.3.6. Visualización de mensajes.</h4>
<div class="paragraph">
<p>El componente <code>Home.jsx</code> es responsable de mostrar el historial de mensajes y gestionar el desencriptado local.</p>
</div>
<div class="paragraph">
<p>Cuando el usuario abre una conversación, se reciben últimos 10 mensajes desde el servidor. Antes de ser renderizados, estos mensajes se desencriptan en el navegador usando la clave privada almacenada en <code>IndexedDB</code>.</p>
</div>
<div class="paragraph">
<p>Además, si el usuario hace scroll hacia arriba, se activa un <code>IntersectionObserver</code> que llama automáticamente a <code>loadMoreMessages()</code>, el cual carga más mensajes anteriores desde el servidor y los desencripta del mismo modo.</p>
</div>
<div class="listingblock">
<div class="title">Fragmento Home.jsx</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="jsx"><span class="kd">const</span> <span class="nx">loadMoreMessages</span> <span class="o">=</span> <span class="nf">useCallback</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">noMoreMessages</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

    <span class="kd">const</span> <span class="nx">firstMessage</span> <span class="o">=</span> <span class="nx">localMessages</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="nx">axios</span>
        <span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="nf">route</span><span class="p">(</span><span class="dl">"</span><span class="s2">message.loadOlder</span><span class="dl">"</span><span class="p">,</span> <span class="nx">firstMessage</span><span class="p">.</span><span class="nx">id</span><span class="p">))</span>
        <span class="p">.</span><span class="nf">then</span><span class="p">(</span><span class="k">async </span><span class="p">({</span> <span class="nx">data</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">if </span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="nf">setNoMoreMessages</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="kd">const</span> <span class="nx">scrollHeight</span> <span class="o">=</span> <span class="nx">messagesCtrRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">scrollHeight</span><span class="p">;</span>
            <span class="kd">const</span> <span class="nx">scrollTop</span> <span class="o">=</span> <span class="nx">messagesCtrRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">scrollTop</span><span class="p">;</span>
            <span class="kd">const</span> <span class="nx">clientHeight</span> <span class="o">=</span> <span class="nx">messagesCtrRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">clientHeight</span><span class="p">;</span>
            <span class="kd">const</span> <span class="nx">tmpScrollFromBottom</span> <span class="o">=</span> <span class="nx">scrollHeight</span> <span class="o">-</span> <span class="nx">scrollTop</span> <span class="o">-</span> <span class="nx">clientHeight</span><span class="p">;</span>
            <span class="nf">setScrollFromBottom</span><span class="p">(</span><span class="nx">tmpScrollFromBottom</span><span class="p">);</span>

            <span class="kd">const</span> <span class="nx">decrypted</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">decryptAllMessages</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
            <span class="nf">setLocalMessages</span><span class="p">((</span><span class="nx">prev</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">[...</span><span class="nx">decrypted</span><span class="p">.</span><span class="nf">reverse</span><span class="p">(),</span> <span class="p">...</span><span class="nx">prev</span><span class="p">]);</span>
        <span class="p">});</span>
<span class="p">},</span> <span class="p">[</span><span class="nx">localMessages</span><span class="p">,</span> <span class="nx">noMoreMessages</span><span class="p">]);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>La posición de scroll se conserva tras cargar mensajes antiguos, para evitar saltos visuales en la interfaz.</p>
</div>
<div class="paragraph">
<p>Además, si el usuario recibe o manda un mensaje y se encuentra abajo, el scroll  también se moverá hacia abajo de tal forma que el mensaje se pordrá leer sin necesidad de hacer scroll manualmente.</p>
</div>
<div class="sect4">
<h5 id="_observador_de_intersección">Observador de intersección</h5>
<div class="paragraph">
<p>Este fragmento configura el <code>IntersectionObserver</code>, que dispara la carga cuando el marcador <code>loadMoreIntersect</code> entra en el viewport:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="jsx"><span class="nf">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">observer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">IntersectionObserver</span><span class="p">(</span>
        <span class="p">(</span><span class="nx">entries</span><span class="p">)</span> <span class="o">=&gt;</span>
            <span class="nx">entries</span><span class="p">.</span><span class="nf">forEach</span><span class="p">((</span><span class="nx">entry</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">isIntersecting</span> <span class="o">&amp;&amp;</span> <span class="nf">loadMoreMessages</span><span class="p">()),</span>
        <span class="p">{</span> <span class="na">rootMargin</span><span class="p">:</span> <span class="dl">"</span><span class="s2">0px 0px 250px 0px</span><span class="dl">"</span> <span class="p">}</span>
    <span class="p">);</span>

    <span class="k">if </span><span class="p">(</span><span class="nx">loadMoreIntersect</span><span class="p">.</span><span class="nx">current</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">observer</span><span class="p">.</span><span class="nf">observe</span><span class="p">(</span><span class="nx">loadMoreIntersect</span><span class="p">.</span><span class="nx">current</span><span class="p">),</span> <span class="mi">100</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return </span><span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">observer</span><span class="p">.</span><span class="nf">disconnect</span><span class="p">();</span>
<span class="p">},</span> <span class="p">[</span><span class="nx">localMessages</span><span class="p">]);</span></code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusiones">4. Conclusiones</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Durante el desarrollo de este proyecto me propuse aplicar todos los conocimientos adquiridos a lo largo de estos dos años. Tras descartar varias ideas iniciales, pensé que el despliegue de un chat cifrado sería una opción ideal, ya que integra múltiples áreas de conocimiento: criptografía, bases de datos, desarrollo backend con PHP mediante el framework Laravel, frontend con React (JavaScript) y diseño visual utilizando TailwindCSS. Además, incluye despliegue automatizado, integración continua y una orquestación mediante scripts, con el objetivo de lograr la máxima disponibilidad del sistema.</p>
</div>
<div class="paragraph">
<p>Este proyecto me ha permitido ir más allá de los contenidos vistos en clase, profundizando en herramientas y tecnologías reales. Aunque muchas de las tecnologías empleadas se basan en lo aprendido en el ciclo, he tenido que investigar por mi cuenta para poder aplicarlas correctamente.</p>
</div>
<div class="paragraph">
<p>Los mayores retos surgieron precisamente en las áreas que no se han abordado directamente durante la formación. Uno de los principales fue la implementación de la comunicación en tiempo real mediante WebSockets. Probé muchas soluciones hasta que encontré en Laravel Reverb. Aun así, su integración con HTTPS y Nginx me supuso varios días de pruebas y resolución de conflictos relacionados con certificados y la configuración del proxy inverso.</p>
</div>
<div class="paragraph">
<p>Comencé el desarrollo del sistema durante las vacaciones de Navidad, trabajando en un prototipo de sistema de cifrado basado en RSA. Esta primera versión la permitió la implementación de la funcionalidad más importante del proyecto: la encriptación total de los mensajes, garantizando la confidencialidad incluso frente al propio servidor.</p>
</div>
<div class="paragraph">
<p>La evolución del proyecto ha sido bastante fluida, y he aprendido a desarrollar de forma iterativa, resolviendo los problemas a medida que surgían y reflexionando sobre posibles mejoras con cada avance.</p>
</div>
<div class="paragraph">
<p>Más allá del aspecto técnico, me siento muy satisfecho con el resultado funcional y el potencial real de la aplicación. La posibilidad de enviar mensajes cifrados de forma anónima, segura y desde un navegador es una característica que pocas aplicaciones ofrecen actualmente. De hecho, la mayoría de servicios de mensajería cifrada están limitados a entornos móviles o de escritorio, mientras que este proyecto propone una solución accesible desde cualquier dispositivo con conexión web.</p>
</div>
<div class="paragraph">
<p>El sistema está diseñado para ser ampliable y creo sinceramente que puede convertirse en un producto real. Las posibilidades de evolución son muchas: desde la integración de inteligencia artificial en chats, hasta la conexión con servicios de almacenamiento cifrado para sincronizar adjuntos o integrar backups seguros.</p>
</div>
<div class="paragraph">
<p>El desarrollo ha sido una experiencia increíblemente enriquecedora, aunque también exigente, y ha sido mucho más llevadero gracias al apoyo y la implicación del profesorado, a quienes quiero agradecer especialmente.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_recursos_bibliográficos_y_páginas_web_consultadas">5. Recursos bibliográficos y páginas web consultadas</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.docker.com/guides/frameworks/laravel/development-setup/">Laravel Development Setup with Docker Compose - Docker Docs</a> - 05/01/2025</p>
</li>
<li>
<p><a href="https://laravel.com/docs/12.x/authentication">Laravel Docs - “Authentication”</a> - 05/01/2025</p>
</li>
<li>
<p><a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-laravel-nginx-and-mysql-with-docker-compose">How To Set Up Laravel, Nginx, and MySQL with Docker Compose</a> - 07/01/2025</p>
</li>
<li>
<p><a href="https://docs.docker.com/">Docker Docs - Official Documentation</a> - 07/01/2025</p>
</li>
<li>
<p><a href="https://laravel.com/docs/11.x/encryption">Laravel Docs - “Encryption”</a> - 06/01/2025</p>
</li>
<li>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Crypto_API">MDN Web Docs - “Web Crypto API”</a> - 08/01/2025</p>
</li>
<li>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API">MDN Web Docs - “WebSocket API”</a> - 09/01/2025</p>
</li>
<li>
<p><a href="https://medium.com/@leoonofre.oliversoft/how-to-set-up-a-laravel-with-docker-compose-mysql-and-nginx-part-01-dd0255692b9d">How to Set Up a Laravel with Docker Compose, MySQL, and Nginx — Part 01</a> - 10/01/2025</p>
</li>
<li>
<p><a href="https://medium.com/@faidfadjri/how-to-setup-laravel-nginx-using-docker-2023-ba9de4b60d04">Medium - “Setup Laravel + Nginx using Docker”</a> - 12/01/2025</p>
</li>
<li>
<p><a href="https://medium.com/@leoonofre.oliversoft/how-to-set-up-a-laravel-with-docker-compose-mysql-and-nginx-part-02-793f8ddf5a76">How to Set Up a Laravel with Docker Compose, MySQL, and Nginx — Part 02</a> - 15/01/2025</p>
</li>
<li>
<p><a href="https://www.youtube.com/watch?v=ImtZ5yENzgE">Laravel full tutorial - Youtube video</a> - 15/01/2025</p>
</li>
<li>
<p><a href="https://docs.docker.com/guides/frameworks/laravel/production-setup/">Docker Docs - “Laravel Production Setup with Docker Compose”</a> - 18/01/2025</p>
</li>
<li>
<p><a href="https://redis.io/docs/latest/develop/interact/pubsub/">Redis Docs - Pub/Sub</a> - 19/01/2025</p>
</li>
<li>
<p><a href="https://laravel.com/docs/12.x/broadcasting">Laravel Docs - Broadcasting</a> - 20/01/2025</p>
</li>
<li>
<p><a href="https://github.com/tlaverdure/laravel-echo-server">GitHub - “laravel-echo-server” (Socket.io server for Laravel Echo)</a> - 21/01/2025</p>
</li>
<li>
<p><a href="https://medium.com/@titasgailius/running-laravel-echo-server-the-right-way-32f52bb5b1c8">Medium - “Running Laravel Echo Server the right way”</a> - 22/01/2025</p>
</li>
<li>
<p><a href="https://github.com/demarillacizere/Realtime-Chat">GitHub - “Realtime-Chat” (Laravel &amp; Livewire)</a> - 25/01/2025</p>
</li>
<li>
<p><a href="https://github.com/boolfalse/laravel-reverb-react-chat">GitHub - “laravel-reverb-react-chat” (Laravel Reverb example)</a> - 26/01/2025</p>
</li>
<li>
<p><a href="https://github.com/raprmdn/laravel-chat-app">GitHub - “laravel-chat-app” (Laravel, InertiaJS, React, Soketi)</a> - 27/01/2025</p>
</li>
<li>
<p><a href="https://stackoverflow.com/questions/73599557/laravel-websockets-with-nginx">StackOverflow - “Laravel websockets with nginx”</a> - 29/01/2025</p>
</li>
<li>
<p><a href="https://dexie.org/">Dexie.js - IndexedDB wrapper</a> - 30/01/2025</p>
</li>
<li>
<p><a href="https://beyondco.de/docs/laravel-websockets">Beyond Code - “Laravel WebSockets”</a> - 02/02/2025</p>
</li>
<li>
<p><a href="https://developer.mozilla.org/es/docs/Web/API/Web_Crypto_API">Web Crypto API - MDN Docs</a> - 02/02/2025</p>
</li>
<li>
<p><a href="https://laravel.com/docs/12.x/sanctum">Laravel Docs - Sanctum (SPA/API Auth)</a> - 04/02/2025</p>
</li>
<li>
<p><a href="https://www.youtube.com/watch?v=WlDJlO_F5U4">Encriptación con JavaScript, AES y la Web Crypto API</a> - 04/02/2025</p>
</li>
<li>
<p><a href="https://dev.to/cardoso/end-to-end-encrypted-chat-with-the-web-crypto-api-3d02">End-to-End Encrypted Chat with the Web Crypto API</a> - 05/02/2025</p>
</li>
<li>
<p><a href="https://medium.com/devlisty/real-time-chat-application-with-laravel-11-and-socket-00f5f24542d8">Medium - “Real-time Chat App with Laravel 11 &amp; Socket”</a> - 07/02/2025</p>
</li>
<li>
<p><a href="https://medium.com/@tony.infisical/guide-to-web-crypto-api-for-encryption-decryption-1a2c698ebc25">Guide to Web Crypto API for encryption/decryption</a> - 08/02/2025</p>
</li>
<li>
<p><a href="https://medium.com/@ibrahimoglakci/building-a-real-time-chat-application-with-laravel-and-pusher-8f3e11e5ba06">Medium - “Building a Real-Time Chat App with Laravel &amp; Pusher”</a> - 09/02/2025</p>
</li>
<li>
<p><a href="https://www.youtube.com/watch?v=CgkZ7MvWUAA">React full course - Youtube video</a> - 11/02/2025</p>
</li>
<li>
<p><a href="https://www.twilio.com/blog/build-real-time-chat-app-laravel-vuejs-pusher">Twilio Blog – “Build Real-Time Chat App with Laravel, Vue.js &amp; Pusher”</a> - 12/02/2025</p>
</li>
<li>
<p><a href="https://itsolutionstuff.com/post/laravel-broadcast-redis-socket-io-tutorial-example.html">ItSolutionStuff - “Laravel Broadcast with Redis &amp; Socket.io Tutorial”</a> - 15/02/2025</p>
</li>
<li>
<p><a href="https://www.desarrollolibre.net/blog/laravel/como-crear-una-aplicacion-de-chat-en-tiempo-real-con-laravel-reverb">Desarrollolibre - “Cómo crear una app de chat con Laravel Reverb”</a> - 18/02/2025</p>
</li>
<li>
<p><a href="https://medium.com/slalom-build/managing-keys-with-web-cryptography-api-5faac6f99ca7">Managing Keys with the Web Cryptography API</a> - 20/02/2025</p>
</li>
<li>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API">MDN Web Docs - IndexedDB API</a> - 20/02/2025</p>
</li>
<li>
<p><a href="https://www.youtube.com/watch?v=BEKiNgcBqJw">YouTube - “Real Time Chat with Laravel Reverb”</a> - 25/02/2025</p>
</li>
<li>
<p><a href="https://developer.mozilla.org/es/docs/Web/API/IndexedDB_API/Using_IndexedDB">Usando IndexedDB - MDN Docs</a> - 01/03/2025</p>
</li>
<li>
<p><a href="https://wpwebinfotech.com/blog/laravel-file-upload/">WPWebInfoTech - “Laravel File Upload: Step-by-Step”</a> - 03/03/2025</p>
</li>
<li>
<p><a href="https://dev.to/bgopikrishna/indexeddb-on-steroids-using-dexiejs-1ej4">IndexedDB on steroids using Dexie.js</a> - 05/03/2025</p>
</li>
<li>
<p><a href="https://dev.to/madsstoumann/dark-mode-in-3-lines-of-css-and-other-adventures-1ljj">Dev.to - “Dark Mode in 3 Lines of CSS”</a> - 07/03/2025</p>
</li>
<li>
<p><a href="https://gist.github.com/saulshanabrook/b74984677bccd08b028b30d9968623f5">Saving Web Crypto Keys using IndexedDB (GitHub Gist)</a> - 07/03/2025</p>
</li>
<li>
<p><a href="https://medium.com/@volodymyrzh/implementing-dark-mode-with-css-and-javascript-fd3b2105e081">Medium - “Implementing Dark Mode with CSS &amp; JS”</a> - 10/03/2025</p>
</li>
<li>
<p><a href="https://dev.to/alexeagleson/how-to-use-indexeddb-to-store-data-for-your-web-application-in-the-browser-1o90">How to use IndexedDB to Store Local Data for your Web Application</a> - 10/03/2025</p>
</li>
<li>
<p><a href="https://www.w3schools.com/howto/howto_js_toggle_dark_mode.asp">W3Schools - “Toggle Dark/Light Mode”</a> - 12/03/2025</p>
</li>
<li>
<p><a href="https://dev.to/quicksilversel/create-a-darklight-mode-toggle-using-javascript-localstorage-55fd">Create a Dark/Light Mode Toggle using JavaScript &amp; LocalStorage</a> - 15/03/2025</p>
</li>
<li>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia">MDN Web Docs - “MediaDevices.getUserMedia()”</a> - 15/03/2025</p>
</li>
<li>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/@media/prefers-color-scheme">prefers-color-scheme - MDN</a> - 17/03/2025</p>
</li>
<li>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/API/MediaStream_Recording_API/Using_the_MediaStream_Recording_API">MDN Web Docs - “MediaStream Recording API”</a> - 18/03/2025</p>
</li>
<li>
<p><a href="https://stackoverflow.com/questions/70117921/how-can-i-use-localstorage-in-a-dark-mode-toggle">How can I use localStorage in a dark mode toggle?</a> - 18/03/2025</p>
</li>
<li>
<p><a href="https://whitep4nth3r.com/blog/best-light-dark-mode-theme-toggle-javascript/">The best light/dark mode theme toggle in JavaScript</a> - 20/03/2025</p>
</li>
<li>
<p><a href="https://spatie.be/docs/laravel-medialibrary/v11/introduction">Spatie - “Laravel Media Library” (file uploads)</a> - 22/03/2025</p>
</li>
<li>
<p><a href="https://laravel.com/docs/12.x/dusk">Laravel Docs - “Browser Testing (Dusk)”</a> - 24/03/2025</p>
</li>
<li>
<p><a href="https://laravel.com/docs/12.x/envoy">Laravel Docs - “Envoy (deployment)”</a> - 02/04/2025</p>
</li>
<li>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/API/MediaStream_Recording_API/Using_the_MediaStream_Recording_API">Using the MediaStream Recording API - MDN</a> - 02/04/2025</p>
</li>
<li>
<p><a href="https://www.twilio.com/en-us/blog/mediastream-recording-api">An introduction to the MediaRecorder API</a> - 04/04/2025</p>
</li>
<li>
<p><a href="https://dev.to/ethand91/mediarecorder-api-tutorial-54n8">MediaRecorder API Tutorial</a> - 06/04/2025</p>
</li>
<li>
<p><a href="https://www.youtube.com/watch?v=6TuEXV3VWOg">Grabar audio del micrófono con JavaScript y PHP</a> - 08/04/2025</p>
</li>
<li>
<p><a href="https://laravel.com/docs/11.x/broadcasting">Broadcasting - Laravel 11.x Docs</a> - 12/04/2025</p>
</li>
<li>
<p><a href="https://beyondco.de/docs/laravel-websockets/getting-started/introduction">Laravel WebSockets - BeyondCode Docs</a> - 14/04/2025</p>
</li>
<li>
<p><a href="https://laravel.com/docs/12.x/deployment">Laravel Docs - “Deployment” (general)</a> - 17/04/2025</p>
</li>
<li>
<p><a href="https://www.honeybadger.io/blog/a-guide-to-using-websockets-in-laravel/">A guide to using WebSockets in Laravel</a> - 18/04/2025</p>
</li>
<li>
<p><a href="https://www.freecodecamp.org/news/laravel-reverb-realtime-chat-app/">How to Build a Real-Time Chat App with Laravel Reverb</a> - 20/04/2025</p>
</li>
<li>
<p><a href="https://github.com/laravel/echo">GitHub - laravel/echo: Laravel Echo library for beautiful Reverb, Pusher, and Ably integration.</a> - 22/04/2025</p>
</li>
<li>
<p><a href="https://57blocks.io/blog/frontend-performance-optimization">Optimización de rendimiento Front-End (57Blocks)</a> - 26/04/2025</p>
</li>
<li>
<p><a href="https://www.arsys.es/blog/web-performance-optimization">Optimización del rendimiento web: buenas prácticas (Arsys)</a> - 26/04/2025</p>
</li>
<li>
<p><a href="https://es.stackoverflow.com/questions/489548/laravel-websockets-en-channel-private">StackOverflow ES - “Laravel WebSockets en canal privado”</a> - 01/05/2025</p>
</li>
<li>
<p><a href="https://stackoverflow.com/questions/74086293/laravel-event-not-being-broadcasted-web-laravel-websockets-server">Laravel event not being broadcasted with laravel-websockets server</a> - 03/05/2025</p>
</li>
<li>
<p><a href="https://reverb.laravel.com/">Laravel Reverb (first-party WebSocket server)</a> - 05/05/2025</p>
</li>
<li>
<p><a href="https://stackoverflow.com/questions/76457729/decrypt-cryptojs-using-laravel-with-dynamic-key">StackOverflow - “Decrypt CryptoJS using Laravel”</a> - 10/05/2025</p>
</li>
<li>
<p><a href="https://stackoverflow.com/questions/47152307/how-to-add-real-time-chat-with-notifications-in-laravel-project">StackOverflow - “Real-time chat with notifications (Laravel)”</a> - 12/05/2025</p>
</li>
<li>
<p><a href="https://www.aquasec.com/cloud-native-academy/docker-container/microservices-and-containerization/">Arquitectura de microservicios y contenedores (AquaSec)</a> - 14/05/2025</p>
</li>
<li>
<p><a href="https://medium.com/be-tech-with-santander/uso-de-docker-overlay-networks-gu%C3%ADa-de-configuraci%C3%B3n-f784c309fe7b">Redes superpuestas (Overlay) en Docker: guía de configuración</a> - 15/05/2025</p>
</li>
<li>
<p><a href="https://www.cloudthat.com/resources/blog/docker-networking-exploring-bridge-host-and-overlay-modes">Explorando redes Docker: modos Bridge, Host y Overlay</a> - 15/05/2025</p>
</li>
<li>
<p><a href="https://www.programador-web.com/2024/10/21/las-ultimas-buenas-practicas-para-programar-en-react-en-2024/">Buenas prácticas en React para 2024 (Programador Web)</a> - 16/05/2025</p>
</li>
<li>
<p><a href="https://dev.to/dennysjmarquez/react-la-guia-maxima-de-buenas-practicas-jamas-concebida-principios-solid-el-acronimo-stupid-clean-code-y-code-smell-53l7">Guía de buenas prácticas en React (principios SOLID y Clean Code)</a> - 16/05/2025</p>
</li>
<li>
<p><a href="https://www.invicti.com/blog/web-security/websocket-security-best-practices/">Seguridad en WebSockets: riesgos y buenas prácticas (Invicti)</a> - 18/05/2025</p>
</li>
<li>
<p><a href="https://dev.to/ably/websocket-security-9-common-vulnerabilities-prevention-methods-4kil">Seguridad en WebSockets: 9 vulnerabilidades comunes y cómo prevenirlas</a> - 18/05/2025</p>
</li>
<li>
<p><a href="https://devcenter.heroku.com/articles/websocket-security">Seguridad en WebSockets (Heroku Dev Center)</a> - 19/05/2025</p>
</li>
<li>
<p><a href="https://www.hostinger.com/es/tutoriales/como-configurar-proxy-inverso-nginx">Proxy inverso NGINX: configuración (HTTPS, SSL)</a> - 20/05/2025</p>
</li>
<li>
<p><a href="https://docs.docker.com/get-started/docker-concepts/running-containers/publishing-ports/">Exposición de puertos en Docker (Docker Docs)</a> - 20/05/2025</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_anexos">6. Anexos</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/PumukyDev/pi-pumukydev/blob/gh-pages/2ASIR_B_BERTOS_GOMEZ_ADRIAN_PUMUKYCHAT-Anexo1.pdf">Anexo 1</a>.</p>
</li>
<li>
<p><a href="https://github.com/PumukyDev/pi-pumukydev/blob/gh-pages/2ASIR_B_BERTOS_GOMEZ_ADRIAN_PUMUKYCHAT-Anexo2.pdf">Anexo 2</a>.</p>
</li>
<li>
<p><a href="https://github.com/PumukyDev/pi-pumukydev/blob/gh-pages/2ASIR_B_BERTOS_GOMEZ_ADRIAN_PUMUKYCHAT-Anexo3.pdf">Anexo 3</a>.</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2025-05-27 08:18:00 UTC
</div>
</div>
</body>
</html>